const is_modal=function(){return apex.env.APP_PAGE_ID!==apex.util.getTopApex().env.APP_PAGE_ID};var ping_loop,last_scheduler,ping_active=!(apex.env.APP_PAGE_ID!==apex.util.getTopApex().env.APP_PAGE_ID);const init_page_asap=function(){apex.theme42.util.configAPEXMsgs({autoDismiss:!0,duration:2300}),apex.message.setThemeHooks({beforeShow:function(e,t){if($("#t_Alert_Success").attr("style","display: block !important"),$("#t_Alert_Notification").attr("style","display: block !important"),e===apex.message.TYPE.ERROR){if(0==(o=get_message(t.find("ul.a-Notification-list li").html())).message.trim().length)return;if(console.log("MESSAGE.ERROR:",o),"WARNING"==o.status&&t.find(".t-Alert--warning").addClass("t-Alert--yellow"),t.find(".a-Notification-item").first().html(o.message),o.message.toUpperCase().includes("YOUR SESSION HAS ENDED")){ping_active=!1;for(var a=0;a<=ping_loop;a++)clearTimeout(a);redirect_to_login()}}if(e===apex.message.TYPE.SUCCESS){var o;if(0==(o=get_message($("#APEX_SUCCESS_MESSAGE h2.t-Alert-title").html())).message.trim().length)return;console.log("MESSAGE.SUCCESS:",o),$("#APEX_SUCCESS_MESSAGE h2.t-Alert-title").text(o.message),clearTimeout(last_scheduler),last_scheduler=setTimeout((()=>{apex.message.hidePageSuccess()}),2300)}o.action&&(console.log("TRIGGER_ACTION",o.action),$.event.trigger(o.action))},beforeHide:function(e,t){}});var e=parseInt(apex.item("P0_AJAX_PING_INTERVAL").getValue()),t=function(){ping_active&&(console.log("CALL AJAX_PING"),apex.server.process("AJAX_PING",{},{async:!0,dataType:"text",success:function(e){if(e.trim().length>0)try{const t=JSON.parse(e);console.log("PING RECEIVED, JSON",t),show_message(t)}catch(t){console.log("PING RECEIVED, TEXT",e,t),show_message(e)}}}),ping_active&&e>0&&(ping_loop=setTimeout((function(){t()}),1e3*e)))};ping_active&&e>0&&apex.item("P0_AJAX_PING_INTERVAL").node&&(ping_loop=t())},init_page=function(){$(".a-IG").each((function(){var e=$(this).parent(),t=e.attr("id");e.hasClass("ORIGINAL")||($("#"+t).on("interactivegridviewchange",(function(e,a){alert("GRID CREATED "+t)})),fix_grid_toolbar(t))})),$("button > .t-Button-label").each((function(e,t){$(t).html($(t).html().replace(/\[([^\]]+)\]/,'<div class="BADGE">$1</div>'))})),$("body").on("click","button.ACTION_MENU",show_action_menu),$("html").click((function(){$("div.ACTION_MENU").hide()})),$("div.ACTION_MENU a").click((function(e){var t=$(this);console.log("MENU CLICK",t,e)})),$(document).on("ajaxComplete",(function(e,t,a){var o,i;try{o=t.responseJSON.regions[0].id,i=$(".t-IRR-region.lto"+o+"_0").attr("id")}catch(e){}200==t.status&&void 0!==i&&delay(100).then((()=>fix_grid_default(i)))})),delay(300).then((()=>init_page_delayed()))},init_page_delayed=function(){$(".a-IG").each((function(){var e=$(this).parent(),t=e.attr("id");e.hasClass("ORIGINAL")||fix_grid_default(t)}))};$((function(){init_page_asap(),reset_tabs()})),apex.jQuery(window).on("theme42ready",(function(){$(".a-IG").each((function(){var e=$(this).parent(),t=e.attr("id");e.hasClass("ORIGINAL")||($("#"+t).on("interactivegridviewchange",(function(e,a){alert("GRID CREATED "+t)})),fix_grid_toolbar(t))})),$("button > .t-Button-label").each((function(e,t){$(t).html($(t).html().replace(/\[([^\]]+)\]/,'<div class="BADGE">$1</div>'))})),$("body").on("click","button.ACTION_MENU",show_action_menu),$("html").click((function(){$("div.ACTION_MENU").hide()})),$("div.ACTION_MENU a").click((function(e){var t=$(this);console.log("MENU CLICK",t,e)})),$(document).on("ajaxComplete",(function(e,t,a){var o,i;try{o=t.responseJSON.regions[0].id,i=$(".t-IRR-region.lto"+o+"_0").attr("id")}catch(e){}200==t.status&&void 0!==i&&delay(100).then((()=>fix_grid_default(i)))})),delay(300).then((()=>init_page_delayed()))}));const redirect_to_login=function(){800==apex.env.APP_ID&&9999==apex.env.APP_PAGE_ID&&(0==apex.env.APP_SESSION||window.location.search.startsWith("?p=800:9999:0:")||window.location.search.startsWith("?session=0"))||(apex.item("P0_SESSION_TIMEOUT_URL").getValue()?window.location.href=apex.item("P0_SESSION_TIMEOUT_URL").getValue():apex.navigation.redirect("/ords/f?p=800:9999:0::::P9999_ERROR:SESSION_TIMEOUT"))},check_session=function(){$(document).on("dialogopen",(function(e){if($('button:contains("Sign In Again")').length>0)return e.preventDefault(),e.stopPropagation(),!1}))},show_success=function(e){apex.message.showPageSuccess(JSON.stringify(get_message(e,"SUCCESS")))},show_warning=function(e){apex.message.clearErrors(),apex.message.showErrors([{type:apex.message.TYPE.ERROR,location:["page"],message:JSON.stringify(get_message(e,"WARNING")),unsafe:!1}])},show_error=function(e){apex.message.clearErrors(),apex.message.showErrors([{type:apex.message.TYPE.ERROR,location:["page"],message:JSON.stringify(get_message(e,"ERROR")),unsafe:!1}])},show_message=function(e){(e=get_message(e)).message&&("SUCCESS"==e.status?show_success(e):"WARNING"==e.status?show_warning(e):show_error(e))},get_message=function(e,t,a){var o={message:e,status:t,action:a};if("object"==typeof e)o.message=e.message?e.message:o.message,o.status=e.status?e.status:o.status,o.action=e.action?e.action:o.action;else if("string"==typeof e&&"{"===e.substring(0,1)&&"}"===e.trim().slice(-1))try{const t=JSON.parse(e);o.message=t.message?t.message:o.message,o.status=t.status?t.status:o.status,o.action=t.action?t.action:o.action}catch(t){console.error("JSON_PARSE_FAILED",e,t)}return o},wait_for_element=function(e,t,a,o){new MutationObserver((function(i){$(e).length&&(a(e,t),o&&observer.disconnect())})).observe(document.getElementById(t),{childList:!0,subtree:!0})},delay=function(e){return new Promise((t=>setTimeout(t,e)))},copy_to_clipboard=function(e){if(navigator.clipboard&&navigator.clipboard.writeText)try{navigator.clipboard.writeText(e)}catch(e){console.log("FAIL",e)}else{const t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select();try{document.execCommand("copy")}catch(e){console.log("FAIL",e)}document.body.removeChild(t)}};document.addEventListener("copy",(e=>{const t=document.activeElement.closest(`.${"a-GV-cell".replace(/\s+/g,".")}`);if(t&&"TD"===t.tagName){let t=window.getSelection().toString().trim();t||(t=$(document.activeElement)[0].innerText),t&&(copy_to_clipboard(t),console.log("COPIED",t),e.preventDefault())}}));const color_cell=function(e,t,a,o,i){return t&&t.length&&(o&&o.length||i&&i.length)?e.defaultGridColumnOptions={cellTemplate:'<div style="background: '+o+"; color: "+i+';" title="'+a+'">'+t+"</div>"}:e.defaultGridColumnOptions={cellTemplate:'<span title="'+a+'">'+t+"</span>"},e},cell_class=function(e,t,a){return e.defaultGridColumnOptions={cellCssClassesColumn:"CSS_CLASS"},e},fix_grid_toolbar=function(e){console.group("FIX_GRID_TOOLBAR",e);var t=$("#"+e),a=apex.region(e).widget(),o=a.interactiveGrid("getActions"),i=a.interactiveGrid("getToolbar"),n=$.apex.interactiveGrid.copyDefaultToolbar(),s=(n.toolbarFind("actions1"),n.toolbarFind("actions2")),r=n.toolbarFind("actions3"),c=n.toolbarFind("actions4");o.hide("reset-report"),o.show("change-rows-per-page");for(var l=0;l<s.controls.length;l++){if("save"==(d=s.controls[l]).action){d.hot=!1,d.label="Save Changes";break}}for(l=0;l<r.controls.length;l++){var d;if("selection-add-row"==(d=r.controls[l]).action){d.icon="fa fa-plus",d.iconOnly=!0,d.label="Add new row";break}}t.hasClass("SAVE_ALL")&&(o.add({name:"SAVE_ALL",action:function(e,t){var a=e.delegateTarget.id.replace("_ig",""),o=apex.region(a).widget(),i=o.interactiveGrid("getViews","grid").model;console.log("CALL SAVE_ALL",a,o,i),i.forEach((function(e){try{""==i.getValue(e,"MARK_AS_CHANGED")&&i.setValue(e,"MARK_AS_CHANGED","Y ")}catch(e){}})),o.interactiveGrid("getActions").invoke("save"),o.interactiveGrid("getCurrentView").model.fetch()}}),s.controls.push({type:"BUTTON",label:"Save All Rows",id:"save_all_rows",icon:"",action:"SAVE_ALL"})),t.hasClass("SAVE_SELECTED")&&(o.add({name:"SAVE_SELECTED",action:function(e,t){var a,o=e.delegateTarget.id.replace("_ig",""),i=apex.region(o).widget(),n=i.interactiveGrid("getViews","grid").model,s=i.interactiveGrid("getViews").grid,r=i.interactiveGrid("getViews").grid.getSelectedRecords(),c=[];console.log("CALL SAVE_SELECTED",o,i,n);for(var l=0;l<r.length;l++)a=s.model.getRecordId(r[l]),c.push(a);n.forEach((function(e){for(var t=0;t<c.length;t++)if(c[t]==s.model.getRecordId(e))try{""==n.getValue(e,"MARK_AS_CHANGED")&&n.setValue(e,"MARK_AS_CHANGED","Y ")}catch(e){}})),i.interactiveGrid("getActions").invoke("save"),i.interactiveGrid("getCurrentView").model.fetch()}}),s.controls.push({type:"BUTTON",label:"Save Selected",id:"save_all_rows",icon:"",action:"SAVE_SELECTED"})),(t.hasClass("AUTO_ALIGN")||t.hasClass("AUTO_WIDTH"))&&(o.add({name:"AUTO_ALIGN_WIDTH",action:function(e,t){var a=e.delegateTarget.id.replace("_ig",""),o=apex.region(a).call("getViews").grid.view$,i=o.grid("getColumns");console.log("CALL AUTO_ALIGN_WIDTH",a,i);for(let e=0;e<i.length-1;e++){if(i[e].hidden)continue;let t=i[e].domId.replace("$","\\$"),a=Math.ceil($("#"+t).outerWidth()+20+1);o.grid("setColumnWidth",i[e].property,a)}}}),c.controls.push({type:"BUTTON",label:"Auto Align Columns",id:"AUTO_ALIGN",icon:"",action:"AUTO_ALIGN_WIDTH"})),c.controls.push({type:"BUTTON",action:"refresh",label:"Refresh",icon:"",iconBeforeLabel:!0}),t.find(".a-GV-footer .a-GV-pagination button.a-GV-pageButton").length&&c.controls.push({type:"SELECT",action:"change-rows-per-page",title:"Rows per page"}),$("#apexDevToolbar.a-DevToolbar")&&c.controls.push({type:"BUTTON",action:"save-report",label:"Save as Default",icon:""});var g=apex.item("P"+apex.env.APP_PAGE_ID+"_"+e+"_BUTTONS").getValue().split(","),u=apex.item("P"+apex.env.APP_PAGE_ID+"_"+e+"_LABELS").getValue().split(","),_=apex.item("P"+apex.env.APP_PAGE_ID+"_"+e+"_ICONS").getValue().split(","),p=apex.item("P"+apex.env.APP_PAGE_ID+"_"+e+"_ACTIONS").getValue().split(",");if(g.length>0)for(l=0;l<g.length;l++)g[l].length>0&&(o.add({name:g[l],action:function(e,t){var a=$(e.currentTarget).attr("id").split("_ig_toolbar_")[1],o=g.indexOf(a);console.log("CALLING",a,p[o]),window[p[o]](e,t)}}),s.controls.push({type:"BUTTON",label:u[l],id:g[l],icon:_[l],action:g[l]}));n.defaultGridViewOptions={persistSelection:!0,rowHeader:"sequence",singleRowView:!1},i.toolbar("option","data",n),i.toolbar("refresh"),console.groupEnd()},fix_grid_save_button=function(){var e=new MutationObserver((function(e){e.forEach((function(e){var t=$(e.target);t.hasClass("is-active")&&t.parent().parent().find('button.a-Toolbar-item[data-action="save"]').addClass("is-active a-Button--hot")}))}));$.each($('.a-Toolbar-button[name="edit"]'),(function(t,a){$el=$(a),e.observe($el[0],{attributes:!0})}))},fix_grid_checkbox=function(e){console.log("FIXING CHECKBOX",e),$("#"+e+" div.a-IG div.a-IG-body div.a-IG-contentContainer div.a-GV div.a-GV-bdy table.a-GV-table.a-GV-table--checkbox tbody td span.u-checkbox").on("click",(function(){var t=apex.region(e);t.call("getActions").get("edit")||(t.call("getActions").set("edit",!0),$(this).closest("th.a-GV-cell.a-GV-selHeader").click())}))},fix_grid_default=function(e){console.group("GRID_MODIFIED + DELAYED",e,t,a);var t=apex.region(e).widget(),a=t.interactiveGrid("getViews","grid").model,o=t.interactiveGrid("getViews").grid;console.log("GRID",t),console.log("MODEL",a),console.log("VIEW",o);var i=apex.item("P#_CURRENT_".replace("#",apex.env.APP_PAGE_ID)+e).getValue();i&&(i=i.replaceAll("&quot;","").replace("[","").replace("]",""),$("#"+e+" .a-GV-bdy tr").each((function(){if(""+$(this).data("id")===i){var e=$(this).find(".a-GV-cell.u-tS.has-button > button > span");e.removeClass("a-Icon").addClass("fa fa-arrow-circle-right"),console.log("CURRENT ROW FIXED",e)}})));var n;a.subscribe({onChange:function(t,a){var o=apex.region(e).widget(),i=o.interactiveGrid("getViews","grid").model,n=o.interactiveGrid("getViews").grid,s={};(n.getColumns().forEach((function(e){s[e.property]=e.index})),console.group("GRID_CHANGED",e,"TYPE:",t,a),$("#"+e).find('button.a-Toolbar-item[data-action="save"]').addClass("is-active a-Button--hot"),"set"!=t&&"insert"!=t||!n.modelColumns.IS_DEFAULT)||(console.log("CHANGED COLUMN","ID="+a.recordId,"COL="+a.field,"OLD="+a.oldValue,"NEW="+a.record[s[a.field]],"DATA:",a.record),"IS_DEFAULT"==a.field&&""===a.oldValue&&"Y"==a.record[s[a.field]]&&(i.forEach((function(e,t,o){o!==a.recordId&&"Y"==i.getValue(e,"IS_DEFAULT")&&i.setValue(e,"IS_DEFAULT","")})),console.warn("CHANGE MODEL",i)));console.groupEnd()}});n=e,console.log("FIXING CHECKBOX",n),$("#"+n+" div.a-IG div.a-IG-body div.a-IG-contentContainer div.a-GV div.a-GV-bdy table.a-GV-table.a-GV-table--checkbox tbody td span.u-checkbox").on("click",(function(){var e=apex.region(n);e.call("getActions").get("edit")||(e.call("getActions").set("edit",!0),$(this).closest("th.a-GV-cell.a-GV-selHeader").click())})),console.groupEnd()},fold_grid_group=function(e,t,a){!function o(i){setTimeout((function(){$("#"+e+" table tbody tr button.a-Button.js-toggleBreak").each((function(){if(i>0){$x=$(this);var e=$x.parent().find(".a-GV-controlBreakLabel"),o=e.find(".a-GV-breakLabel").text(),n=e.find(".a-GV-breakValue").text();if(o.startsWith(t)&&n.trim()==a)return $x.click(),$x.blur(),$(window).scrollTop(0),void(i=0)}})),--i&&o(i)}),200)}(10)},process_grid_all_rows=function(e,t,a){var o=apex.region(e).widget().interactiveGrid("getViews","grid").model;o.forEach((function(e,a){try{o.setValue(e,t,o.getValue(e,t)+"!")}catch(e){}})),apex.submit(a)},process_grid_selected_rows=function(e,t,a,o){for(var i=apex.region(e).widget(),n=i.interactiveGrid("getViews","grid").model,s=i.interactiveGrid("getViews").grid,r=i.interactiveGrid("getViews").grid.getSelectedRecords(),c=[],l=0;l<r.length;l++){var d=s.model.getRecordId(r[l]);c.push(d)}n.forEach((function(e){try{for(var a=0;a<c.length;a++)if(c[a]==s.model.getRecordId(e))try{n.setValue(e,t,"Y")}catch(e){}}catch(e){}})),void 0!==o?i.interactiveGrid("getActions").invoke("save"):apex.submit(a)},count_selected_rows=function(e){for(var t=apex.region(e).widget(),a=(t.interactiveGrid("getViews","grid").model,t.interactiveGrid("getViews").grid),o=t.interactiveGrid("getViews").grid.getSelectedRecords(),i=[],n=0;n<o.length;n++){var s=a.model.getRecordId(o[n]);i.push(s)}return i.length},renumber_grid_rows=function(e,t){var a=apex.region(e).widget().interactiveGrid("getViews","grid").model;a.forEach((function(e,o){var i;try{i=a.setValue(e,t,"#"+o)}catch(t){console.error("ERROR:",o,e,i,t)}}))},grid_one_checkbox_only=function(e,t){var a,o=apex.region(e).widget(),i=o.interactiveGrid("getViews","grid").model,n=o.interactiveGrid("getViews").grid,s=o.interactiveGrid("getViews").grid.getSelectedRecords();s&&s.length>0&&(a=n.model.getRecordId(s[0])),i.forEach((function(e,o,n){try{n!==a&&"Y"===i.getValue(e,t)&&i.setValue(e,t,"")}catch(e){}}))},show_action_menu=function(e){e.preventDefault(),e.stopPropagation();var t=$(this).attr("id"),a=$("button#"+t).offset();console.log("BUTTON",t,a,"MENU",$("div.ACTION_MENU").offset(),$('div.ACTION_MENU[data-id="'+t+'"]')),$("div.ACTION_MENU").css({display:"none"}),$('div.ACTION_MENU[data-id="'+t+'"]').css({display:"block",position:"fixed",top:a.top,left:a.left})},reset_tabs=function(){(window.location.search.includes("&clear=")||window.location.search.includes("?clear="))&&$("div.t-TabsRegion.js-useLocalStorage").each((function(){var e=$(this).attr("id"),t="ORA_WWV_apex.apexTabs."+apex.env.APP_ID+"."+apex.env.APP_PAGE_ID+"."+e+".activeTab",a=sessionStorage.getItem(t);console.log("RESET_TABS",e,t,a),sessionStorage.setItem(t,"")}))},activate_tab=function(e,t){$("div.t-TabsRegion.js-useLocalStorage").each((function(){var a="ORA_WWV_apex.apexTabs."+apex.env.APP_ID+"."+apex.env.APP_PAGE_ID+"."+e+".activeTab";sessionStorage.setItem(a,t)}));var a=apex.region(e).widget();a&&a.aTabs("getTabs")[t].makeActive()};